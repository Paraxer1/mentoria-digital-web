<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Resultados</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: white; padding: 20px; margin: 0; }
        h1 { text-align: center; color: #38bdf8; margin-bottom: 20px; font-size: 1.8rem; margin-top: 10px; }
        
        .grid-charts { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); 
            gap: 25px; max-width: 1200px; margin: 0 auto; 
        }
        
        .chart-box { 
            background: #1e293b; padding: 20px; border-radius: 12px; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.5); border: 1px solid #334155; display: flex; flex-direction: column; align-items: center;
        }
        
        canvas { width: 100% !important; max-height: 250px; }
        
        h3 { text-align: center; margin-bottom: 15px; color: #cbd5e1; font-size: 1rem; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid #334155; padding-bottom: 10px; width: 100%; }
        
        .total-counter { 
            text-align: center; margin-bottom: 30px; font-size: 0.95rem; background: #1e293b; 
            padding: 15px; border-radius: 8px; max-width: 800px; margin-left: auto; margin-right: auto; border: 1px solid #334155;
            display: flex; justify-content: space-around; flex-wrap: wrap; gap: 10px;
        }
        
        .nav-buttons { margin-top: 40px; text-align: center; margin-bottom: 40px; }
        .btn-home { background: #ef4444; color: white; text-decoration: none; padding: 12px 30px; border-radius: 8px; font-weight: bold; font-size: 1.1rem; transition: 0.3s; display: inline-block; }
        .btn-home:hover { background: #dc2626; box-shadow: 0 0 15px rgba(239, 68, 68, 0.4); }
    </style>
</head>
<body>
    <h1>üìä Dashboard de Requisitos (Tiempo Real)</h1>
    
    <div class="total-counter">
        <span>Web: <b id="totalCount1" style="color:#4ade80">0</b></span>
        <span>Telef√≥nica: <b id="totalCount2" style="color:#f59e0b">0</b></span>
        <span>Presencial: <b id="totalCount3" style="color:#38bdf8">0</b></span>
    </div>

    <div class="grid-charts">
        <!-- Gr√°fica 1: Acceso a Equipo (Web) -->
        <div class="chart-box">
            <h3>üíª Acceso a Equipo (Web)</h3>
            <canvas id="pcChart"></canvas>
        </div>
        
        <!-- Gr√°fica 2: IDE Favorito (Telef√≥nica) -->
        <div class="chart-box">
            <h3>üõ†Ô∏è IDE Favorito (Telef√≥nica)</h3>
            <canvas id="editorChart"></canvas>
        </div>

        <!-- Gr√°fica 3: Satisfacci√≥n (Presencial) -->
        <div class="chart-box">
            <h3>‚≠ê Satisfacci√≥n (Presencial)</h3>
            <canvas id="satisfaccionChart"></canvas>
        </div>
    </div>

    <div class="nav-buttons">
        <a href="menu_encuesta.html" class="btn-home">üè† Volver al Men√∫ Principal</a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        // CONFIGURACI√ìN DE FIREBASE (INTEGRADA)
        const firebaseConfig = {
            apiKey: "AIzaSyBKCwkCmn31OOmtNM-y2EBu0FMCPxBSnUg",
            authDomain: "utgz-d4561.firebaseapp.com",
            databaseURL: "https://utgz-d4561-default-rtdb.firebaseio.com",
            projectId: "utgz-d4561",
            storageBucket: "utgz-d4561.firebasestorage.app",
            messagingSenderId: "286177378272",
            appId: "1:286177378272:web:7f2cc9a95e628234d53585",
            measurementId: "G-94TN09QNTP"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const votosRef = ref(db, 'encuestas'); // Ruta principal en Firebase

        // Configuraci√≥n de estilos para gr√°ficas
        const commonOptions = { 
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { labels: { color: 'white' }, position: 'bottom' } }, 
            scales: { y: { beginAtZero: true, ticks: { color: 'white', stepSize: 1 } }, x: { ticks: { color: 'white' } } } 
        };
        const pieOptions = { 
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { labels: { color: 'white' }, position: 'bottom' } }
        };

        // --- INICIALIZACI√ìN DE GR√ÅFICAS ---

        // Gr√°fica 1: Acceso PC (Doughnut)
        const pcLabels = ['Si', 'Compartida', 'No/M√≥vil']; 
        const pcChart = new Chart(document.getElementById('pcChart').getContext('2d'), {
            type: 'doughnut', 
            data: { labels: ['S√≠, propia', 'Compartida', 'No/M√≥vil'], datasets: [{ data: [0, 0, 0], backgroundColor: ['#10b981', '#f59e0b', '#ef4444'], borderWidth: 0 }] },
            options: pieOptions
        });

        // Gr√°fica 2: Editor (Barra)
        const editorLabels = ['VS Code', 'IntelliJ/JetBrains', 'Vim/Nano', 'Otro/Netbeans'];
        const editorChart = new Chart(document.getElementById('editorChart').getContext('2d'), {
            type: 'bar', 
            data: { labels: editorLabels, datasets: [{ label: 'Votos', data: [0, 0, 0, 0], backgroundColor: ['#34d399', '#f87171', '#a78bfa', '#fbbf24'] }] },
            options: commonOptions
        });

        // Gr√°fica 3: Satisfacci√≥n (Polar Area)
        const satLabels = ['Excelente', 'Neutral', 'Bajo'];
        const satisfaccionChart = new Chart(document.getElementById('satisfaccionChart').getContext('2d'), {
            type: 'polarArea', 
            data: { labels: ['Alta', 'Media', 'Baja'], datasets: [{ data: [0, 0, 0], backgroundColor: ['#38bdf8', '#fbbf24', '#ef4444'], borderWidth: 0 }] },
            options: pieOptions
        });

        // --- ESCUCHA DE DATOS EN TIEMPO REAL ---
        onValue(votosRef, (snapshot) => {
            const data = snapshot.val() || { Acceso: {}, Preferencias: {}, Satisfaccion: {} };
            
            // 1. Actualizar Gr√°fica 1 (Acceso)
            const pcData = (data.Acceso && data.Acceso.PC) || {};
            pcChart.data.datasets[0].data = pcLabels.map(l => pcData[l] || 0);
            pcChart.update();
            document.getElementById('totalCount1').innerText = (data.Acceso && data.Acceso.Participacion && data.Acceso.Participacion.Total) || 0;

            // 2. Actualizar Gr√°fica 2 (Preferencias)
            const editorData = (data.Preferencias && data.Preferencias.Editor) || {};
            editorChart.data.datasets[0].data = editorLabels.map(l => editorData[l] || 0);
            editorChart.update();
            document.getElementById('totalCount2').innerText = (data.Preferencias && data.Preferencias.Participacion && data.Preferencias.Participacion.Total) || 0;

            // 3. Actualizar Gr√°fica 3 (Satisfacci√≥n)
            const satData = (data.Satisfaccion && data.Satisfaccion.Satisfaccion) || {};
            satisfaccionChart.data.datasets[0].data = satLabels.map(l => satData[l] || 0);
            satisfaccionChart.update();
            document.getElementById('totalCount3').innerText = (data.Satisfaccion && data.Satisfaccion.Participacion && data.Satisfaccion.Participacion.Total) || 0;
        });
    </script>
</body>
</html>